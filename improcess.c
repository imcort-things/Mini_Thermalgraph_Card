#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include <math.h>

#include "transfer_handler.h"
 
#define SOURCE_X 8
#define SOURCE_Y 8
#define SCALE 8

#define DEST_X (SOURCE_X * SCALE)
#define DEST_Y (SOURCE_Y * SCALE)
 
#define CLAMP(v, min, max) if(v < min) { v = min; } else if(v > max) { v = max; }

static int16_t destination_data[DEST_X * DEST_Y] = {0x0b,0x0c,0x0c,0x0d,0x0e,0x0f,0x11,0x13,0x16,0x18,0x1a,0x1b,0x1b,0x1b,0x1a,0x19,0x18,0x17,0x15,0x14,0x13,0x12,0x11,0x0f,0x0e,0x0d,0x0c,0x0c,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0a,0x0a,0x09,0x08,0x07,0x07,0x06,0x06,0x07,0x07,0x08,0x09,0x0a,0x0b,0x0b,0x0c,0x0d,0x0d,0x0e,0x0e,0x0f,0x0f,0x10,0x10,0x10,0x10,0x10,0x0c,0x0c,0x0c,0x0d,0x0e,0x0f,0x11,0x14,0x16,0x18,0x1a,0x1b,0x1b,0x1b,0x1b,0x1a,0x19,0x18,0x16,0x15,0x14,0x13,0x12,0x11,0x10,0x0f,0x0e,0x0e,0x0d,0x0d,0x0d,0x0d,0x0d,0x0d,0x0e,0x0d,0x0d,0x0d,0x0c,0x0b,0x0a,0x09,0x09,0x09,0x09,0x09,0x0a,0x0a,0x0b,0x0c,0x0d,0x0e,0x0e,0x0f,0x10,0x10,0x11,0x12,0x12,0x13,0x13,0x13,0x13,0x13,0x0c,0x0c,0x0d,0x0d,0x0e,0x10,0x12,0x14,0x16,0x18,0x1a,0x1b,0x1c,0x1c,0x1c,0x1b,0x1a,0x19,0x19,0x18,0x17,0x16,0x16,0x15,0x14,0x13,0x12,0x12,0x11,0x11,0x11,0x11,0x12,0x12,0x12,0x12,0x11,0x11,0x10,0x0f,0x0f,0x0e,0x0d,0x0d,0x0d,0x0d,0x0e,0x0f,0x10,0x11,0x12,0x12,0x13,0x14,0x15,0x16,0x16,0x17,0x18,0x18,0x19,0x19,0x19,0x19,0x0d,0x0d,0x0e,0x0e,0x0f,0x10,0x12,0x14,0x16,0x18,0x1a,0x1b,0x1c,0x1d,0x1d,0x1d,0x1d,0x1c,0x1c,0x1c,0x1b,0x1b,0x1a,0x1a,0x19,0x19,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x17,0x16,0x16,0x15,0x14,0x14,0x13,0x14,0x14,0x15,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20,0x21,0x21,0x22,0x22,0x22,0x0e,0x0e,0x0f,0x0f,0x10,0x11,0x13,0x15,0x16,0x18,0x1a,0x1b,0x1d,0x1e,0x1e,0x1f,0x20,0x20,0x21,0x21,0x21,0x21,0x22,0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x20,0x1f,0x1f,0x1e,0x1d,0x1d,0x1d,0x1d,0x1d,0x1e,0x1f,0x20,0x21,0x22,0x23,0x24,0x25,0x27,0x28,0x29,0x2b,0x2c,0x2d,0x2e,0x2e,0x2e,0x2f,0x10,0x10,0x10,0x11,0x12,0x13,0x14,0x15,0x17,0x18,0x1a,0x1c,0x1d,0x1f,0x21,0x23,0x25,0x27,0x28,0x2a,0x2b,0x2c,0x2d,0x2d,0x2e,0x2e,0x2f,0x2f,0x2f,0x2f,0x2f,0x2f,0x2f,0x2f,0x2f,0x2f,0x2e,0x2e,0x2d,0x2c,0x2b,0x2b,0x2a,0x2a,0x2a,0x2b,0x2b,0x2c,0x2d,0x2f,0x30,0x31,0x33,0x34,0x36,0x39,0x3b,0x3d,0x3e,0x40,0x41,0x41,0x42,0x42,0x12,0x12,0x12,0x13,0x14,0x14,0x15,0x16,0x17,0x19,0x1a,0x1c,0x1e,0x21,0x24,0x28,0x2b,0x2f,0x32,0x35,0x37,0x39,0x3b,0x3d,0x3e,0x3f,0x40,0x41,0x42,0x42,0x42,0x42,0x41,0x41,0x41,0x40,0x40,0x3f,0x3e,0x3d,0x3c,0x3c,0x3b,0x3b,0x3b,0x3c,0x3d,0x3e,0x3f,0x40,0x42,0x44,0x45,0x48,0x4b,0x4e,0x51,0x53,0x56,0x58,0x59,0x5a,0x5b,0x5b,0x15,0x15,0x15,0x15,0x16,0x16,0x17,0x17,0x18,0x19,0x1a,0x1d,0x1f,0x23,0x28,0x2d,0x33,0x38,0x3d,0x42,0x45,0x49,0x4c,0x4e,0x51,0x53,0x54,0x56,0x57,0x57,0x57,0x57,0x56,0x55,0x55,0x54,0x53,0x53,0x52,0x51,0x50,0x4f,0x4e,0x4e,0x4f,0x4f,0x50,0x51,0x53,0x54,0x56,0x58,0x5b,0x5e,0x62,0x66,0x69,0x6d,0x71,0x73,0x75,0x76,0x77,0x77,0x17,0x17,0x17,0x18,0x18,0x18,0x18,0x18,0x18,0x19,0x1b,0x1d,0x21,0x26,0x2c,0x33,0x3a,0x42,0x49,0x4f,0x54,0x58,0x5c,0x60,0x64,0x67,0x69,0x6b,0x6c,0x6d,0x6d,0x6c,0x6c,0x6a,0x69,0x69,0x68,0x67,0x66,0x65,0x64,0x63,0x63,0x63,0x63,0x64,0x65,0x66,0x68,0x6a,0x6c,0x6e,0x71,0x75,0x7a,0x7f,0x84,0x88,0x8c,0x90,0x92,0x93,0x94,0x95,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x19,0x19,0x19,0x1b,0x1e,0x22,0x28,0x30,0x39,0x42,0x4b,0x53,0x5b,0x61,0x67,0x6c,0x71,0x75,0x79,0x7d,0x7f,0x81,0x82,0x82,0x81,0x80,0x7f,0x7e,0x7d,0x7c,0x7b,0x7a,0x79,0x78,0x78,0x77,0x77,0x78,0x79,0x7a,0x7b,0x7d,0x7f,0x81,0x84,0x87,0x8c,0x91,0x97,0x9d,0xa2,0xa7,0xab,0xae,0xaf,0xb1,0xb1,0x1c,0x1c,0x1c,0x1c,0x1c,0x1c,0x1b,0x1a,0x1a,0x1a,0x1b,0x1e,0x23,0x2a,0x33,0x3d,0x48,0x53,0x5d,0x66,0x6d,0x74,0x7a,0x80,0x85,0x89,0x8d,0x90,0x93,0x94,0x94,0x93,0x92,0x91,0x90,0x8f,0x8e,0x8e,0x8d,0x8c,0x8b,0x8b,0x8a,0x8b,0x8b,0x8c,0x8d,0x8f,0x90,0x92,0x95,0x98,0x9c,0xa1,0xa7,0xad,0xb3,0xba,0xbf,0xc3,0xc6,0xc8,0xc9,0xca,0x1d,0x1d,0x1d,0x1d,0x1e,0x1d,0x1c,0x1b,0x1a,0x1b,0x1c,0x1f,0x25,0x2c,0x36,0x41,0x4d,0x58,0x63,0x6d,0x75,0x7d,0x84,0x8a,0x90,0x95,0x9a,0x9d,0xa0,0xa1,0xa2,0xa1,0xa0,0x9f,0x9e,0x9d,0x9d,0x9d,0x9c,0x9c,0x9b,0x9b,0x9b,0x9b,0x9c,0x9d,0x9e,0xa0,0xa1,0xa3,0xa6,0xa9,0xad,0xb2,0xb8,0xbf,0xc6,0xcc,0xd2,0xd6,0xd9,0xdb,0xdd,0xdd,0x1e,0x1e,0x1e,0x1e,0x1e,0x1e,0x1d,0x1c,0x1b,0x1b,0x1d,0x20,0x26,0x2e,0x38,0x43,0x4f,0x5b,0x66,0x71,0x79,0x81,0x88,0x8f,0x95,0x9b,0xa0,0xa4,0xa7,0xa9,0xa9,0xa9,0xa9,0xa8,0xa8,0xa7,0xa8,0xa8,0xa8,0xa8,0xa8,0xa8,0xa8,0xa9,0xaa,0xab,0xac,0xad,0xaf,0xb1,0xb3,0xb6,0xba,0xbf,0xc5,0xcc,0xd2,0xd9,0xde,0xe3,0xe6,0xe8,0xe9,0xea,0x1e,0x1e,0x1e,0x1e,0x1e,0x1e,0x1d,0x1c,0x1b,0x1c,0x1d,0x21,0x26,0x2e,0x38,0x43,0x4e,0x5a,0x65,0x6f,0x78,0x80,0x87,0x8e,0x95,0x9b,0xa0,0xa4,0xa8,0xaa,0xac,0xad,0xad,0xad,0xad,0xae,0xaf,0xb0,0xb1,0xb2,0xb3,0xb4,0xb5,0xb6,0xb7,0xb8,0xb9,0xbb,0xbc,0xbe,0xc0,0xc2,0xc6,0xcb,0xd0,0xd6,0xdc,0xe2,0xe7,0xeb,0xee,0xef,0xf1,0xf1,0x1d,0x1d,0x1d,0x1d,0x1e,0x1d,0x1c,0x1c,0x1b,0x1c,0x1d,0x20,0x25,0x2d,0x36,0x40,0x4b,0x57,0x61,0x6b,0x73,0x7b,0x82,0x89,0x90,0x96,0x9b,0xa0,0xa5,0xa8,0xaa,0xac,0xae,0xaf,0xb0,0xb2,0xb4,0xb6,0xb8,0xba,0xbc,0xbe,0xc0,0xc2,0xc4,0xc5,0xc6,0xc7,0xc8,0xca,0xcb,0xce,0xd1,0xd4,0xd9,0xde,0xe3,0xe8,0xec,0xf0,0xf2,0xf4,0xf5,0xf5,0x1c,0x1c,0x1c,0x1c,0x1d,0x1c,0x1c,0x1b,0x1b,0x1c,0x1d,0x20,0x25,0x2c,0x34,0x3d,0x47,0x52,0x5b,0x64,0x6c,0x74,0x7b,0x82,0x88,0x8f,0x94,0x9a,0x9e,0xa3,0xa6,0xa9,0xac,0xae,0xb1,0xb4,0xb7,0xba,0xbe,0xc1,0xc5,0xc8,0xcb,0xcd,0xd0,0xd1,0xd2,0xd3,0xd4,0xd5,0xd6,0xd7,0xda,0xdd,0xe0,0xe4,0xe8,0xec,0xef,0xf2,0xf4,0xf5,0xf6,0xf6,0x1b,0x1b,0x1b,0x1b,0x1c,0x1c,0x1b,0x1b,0x1b,0x1c,0x1e,0x21,0x25,0x2b,0x32,0x3b,0x44,0x4d,0x55,0x5d,0x65,0x6c,0x73,0x79,0x80,0x86,0x8c,0x92,0x97,0x9c,0xa1,0xa5,0xa9,0xad,0xb1,0xb5,0xb9,0xbe,0xc2,0xc7,0xcc,0xd0,0xd4,0xd7,0xda,0xdc,0xdd,0xdd,0xde,0xde,0xdf,0xdf,0xe1,0xe3,0xe6,0xe8,0xeb,0xee,0xf0,0xf2,0xf3,0xf4,0xf4,0xf5,0x19,0x1a,0x1a,0x1a,0x1b,0x1b,0x1b,0x1c,0x1c,0x1d,0x1f,0x22,0x26,0x2b,0x32,0x39,0x41,0x49,0x50,0x58,0x5e,0x65,0x6b,0x72,0x78,0x7e,0x84,0x8a,0x90,0x96,0x9b,0xa0,0xa6,0xab,0xb0,0xb5,0xba,0xc0,0xc6,0xcc,0xd2,0xd7,0xdc,0xe0,0xe2,0xe4,0xe5,0xe5,0xe5,0xe5,0xe5,0xe5,0xe6,0xe7,0xe9,0xea,0xec,0xed,0xee,0xef,0xf0,0xf1,0xf1,0xf1,0x18,0x18,0x19,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x20,0x22,0x25,0x29,0x2e,0x33,0x3a,0x40,0x47,0x4e,0x54,0x5a,0x61,0x67,0x6d,0x73,0x79,0x7f,0x85,0x8b,0x91,0x97,0x9d,0xa3,0xa9,0xaf,0xb5,0xbb,0xc2,0xc9,0xcf,0xd6,0xdc,0xe1,0xe6,0xe9,0xea,0xeb,0xeb,0xea,0xea,0xe9,0xe9,0xe9,0xe9,0xea,0xea,0xea,0xeb,0xeb,0xeb,0xec,0xec,0xec,0xec,0x17,0x18,0x18,0x19,0x1a,0x1c,0x1d,0x1f,0x21,0x23,0x26,0x2a,0x2e,0x32,0x37,0x3d,0x43,0x49,0x4f,0x55,0x5b,0x60,0x66,0x6c,0x71,0x77,0x7d,0x83,0x89,0x8f,0x96,0x9c,0xa3,0xa9,0xb0,0xb6,0xbd,0xc4,0xcb,0xd2,0xd9,0xdf,0xe5,0xe9,0xec,0xee,0xee,0xee,0xec,0xeb,0xea,0xe9,0xe9,0xe8,0xe8,0xe7,0xe7,0xe7,0xe6,0xe6,0xe6,0xe6,0xe6,0xe6,0x17,0x17,0x18,0x19,0x1b,0x1d,0x1f,0x22,0x26,0x29,0x2d,0x31,0x36,0x3a,0x3f,0x45,0x4a,0x50,0x56,0x5b,0x60,0x66,0x6b,0x70,0x76,0x7b,0x81,0x86,0x8c,0x92,0x99,0x9f,0xa5,0xac,0xb2,0xb8,0xbf,0xc5,0xcd,0xd4,0xda,0xe1,0xe6,0xea,0xed,0xee,0xed,0xec,0xeb,0xe9,0xe7,0xe5,0xe5,0xe4,0xe3,0xe2,0xe1,0xe1,0xe0,0xe0,0xdf,0xdf,0xdf,0xdf,0x16,0x17,0x18,0x1a,0x1c,0x1f,0x23,0x28,0x2d,0x32,0x37,0x3c,0x41,0x47,0x4c,0x51,0x57,0x5c,0x62,0x67,0x6c,0x71,0x76,0x7b,0x7f,0x84,0x89,0x8e,0x93,0x99,0x9e,0xa4,0xaa,0xb0,0xb5,0xbb,0xc0,0xc6,0xcd,0xd3,0xd9,0xdf,0xe3,0xe6,0xe8,0xe9,0xe8,0xe6,0xe3,0xe1,0xde,0xdc,0xdb,0xda,0xd9,0xd8,0xd7,0xd6,0xd5,0xd5,0xd4,0xd4,0xd4,0xd4,0x16,0x16,0x18,0x1a,0x1d,0x22,0x28,0x2e,0x35,0x3c,0x43,0x4a,0x50,0x56,0x5c,0x62,0x67,0x6d,0x72,0x77,0x7c,0x81,0x85,0x89,0x8d,0x91,0x95,0x99,0x9e,0xa2,0xa6,0xab,0xb0,0xb4,0xb9,0xbd,0xc2,0xc6,0xcc,0xd1,0xd6,0xda,0xdd,0xe0,0xe1,0xe0,0xde,0xdb,0xd8,0xd5,0xd1,0xcf,0xcd,0xcc,0xca,0xc9,0xc9,0xc8,0xc7,0xc7,0xc6,0xc6,0xc6,0xc5,0x15,0x16,0x18,0x1b,0x1f,0x25,0x2d,0x35,0x3f,0x48,0x51,0x59,0x60,0x67,0x6e,0x74,0x7a,0x80,0x85,0x8a,0x8f,0x93,0x97,0x9a,0x9d,0xa0,0xa3,0xa6,0xa9,0xad,0xb0,0xb3,0xb6,0xb9,0xbc,0xbf,0xc2,0xc6,0xca,0xcd,0xd1,0xd4,0xd6,0xd7,0xd6,0xd5,0xd2,0xce,0xca,0xc6,0xc2,0xbf,0xbc,0xbb,0xba,0xb9,0xb8,0xb7,0xb7,0xb7,0xb6,0xb6,0xb6,0xb5,0x14,0x16,0x18,0x1c,0x21,0x29,0x32,0x3d,0x49,0x54,0x5f,0x69,0x72,0x79,0x80,0x87,0x8e,0x94,0x99,0x9e,0xa2,0xa6,0xa9,0xac,0xae,0xb0,0xb2,0xb4,0xb6,0xb8,0xba,0xbc,0xbd,0xbf,0xc0,0xc2,0xc3,0xc5,0xc7,0xc9,0xcb,0xcc,0xcd,0xcd,0xcb,0xc8,0xc4,0xbf,0xba,0xb5,0xb1,0xad,0xab,0xa9,0xa8,0xa7,0xa6,0xa6,0xa6,0xa6,0xa6,0xa5,0xa5,0xa5,0x14,0x16,0x19,0x1d,0x23,0x2c,0x38,0x44,0x52,0x60,0x6d,0x79,0x82,0x8b,0x92,0x9a,0xa0,0xa6,0xac,0xb1,0xb5,0xb8,0xbb,0xbd,0xbe,0xbf,0xc0,0xc1,0xc2,0xc3,0xc3,0xc4,0xc4,0xc4,0xc4,0xc4,0xc4,0xc4,0xc5,0xc5,0xc5,0xc5,0xc4,0xc2,0xc0,0xbc,0xb7,0xb1,0xab,0xa5,0xa0,0x9c,0x99,0x97,0x96,0x96,0x96,0x96,0x96,0x96,0x96,0x96,0x96,0x96,0x14,0x16,0x19,0x1e,0x25,0x30,0x3d,0x4c,0x5b,0x6b,0x7a,0x87,0x91,0x9a,0xa2,0xaa,0xb1,0xb7,0xbc,0xc1,0xc5,0xc8,0xca,0xcb,0xcc,0xcc,0xcc,0xcc,0xcc,0xcc,0xcb,0xcb,0xca,0xc8,0xc7,0xc6,0xc5,0xc3,0xc2,0xc1,0xc0,0xbe,0xbc,0xb9,0xb6,0xb1,0xab,0xa4,0x9d,0x97,0x92,0x8d,0x8a,0x88,0x87,0x87,0x87,0x88,0x88,0x89,0x89,0x89,0x88,0x88,0x15,0x17,0x1b,0x20,0x28,0x33,0x41,0x52,0x63,0x74,0x84,0x92,0x9d,0xa7,0xaf,0xb7,0xbd,0xc3,0xc8,0xcc,0xd0,0xd3,0xd4,0xd5,0xd5,0xd5,0xd5,0xd4,0xd4,0xd3,0xd1,0xd0,0xce,0xcc,0xca,0xc8,0xc5,0xc3,0xc1,0xbf,0xbc,0xb9,0xb6,0xb2,0xae,0xa8,0xa1,0x9a,0x93,0x8c,0x86,0x82,0x7f,0x7d,0x7c,0x7c,0x7d,0x7e,0x7f,0x7f,0x7f,0x7f,0x7f,0x7f,0x16,0x18,0x1c,0x22,0x2a,0x36,0x45,0x57,0x69,0x7b,0x8c,0x9a,0xa6,0xaf,0xb7,0xbf,0xc5,0xca,0xce,0xd2,0xd6,0xd8,0xd9,0xda,0xda,0xda,0xd9,0xd8,0xd7,0xd6,0xd5,0xd3,0xd1,0xcf,0xcc,0xca,0xc7,0xc4,0xc1,0xbe,0xba,0xb7,0xb3,0xae,0xa9,0xa3,0x9c,0x95,0x8d,0x86,0x80,0x7c,0x78,0x77,0x76,0x77,0x77,0x79,0x7a,0x7a,0x7a,0x7b,0x7b,0x7b,0x19,0x1b,0x1f,0x25,0x2d,0x3a,0x49,0x5c,0x6f,0x82,0x93,0xa2,0xad,0xb6,0xbd,0xc3,0xc8,0xcc,0xd0,0xd3,0xd6,0xd8,0xd9,0xda,0xda,0xd9,0xd9,0xd8,0xd7,0xd7,0xd6,0xd4,0xd3,0xd1,0xcf,0xcc,0xc9,0xc6,0xc3,0xbf,0xbb,0xb6,0xb2,0xad,0xa8,0xa1,0x9a,0x92,0x8b,0x84,0x7e,0x79,0x76,0x74,0x74,0x74,0x76,0x77,0x78,0x79,0x79,0x79,0x79,0x79,0x1c,0x1e,0x22,0x28,0x30,0x3d,0x4e,0x61,0x74,0x88,0x99,0xa8,0xb2,0xbb,0xc1,0xc6,0xc9,0xcc,0xce,0xd0,0xd3,0xd5,0xd6,0xd6,0xd6,0xd6,0xd6,0xd6,0xd5,0xd5,0xd5,0xd4,0xd4,0xd3,0xd1,0xcf,0xcc,0xc9,0xc5,0xc1,0xbd,0xb8,0xb3,0xad,0xa8,0xa1,0x9a,0x92,0x8b,0x84,0x7e,0x79,0x76,0x75,0x74,0x75,0x76,0x78,0x79,0x7a,0x7a,0x7a,0x7a,0x7a,0x1f,0x21,0x25,0x2c,0x34,0x41,0x52,0x65,0x79,0x8d,0x9e,0xad,0xb7,0xbe,0xc3,0xc6,0xc8,0xc9,0xca,0xcb,0xcd,0xce,0xcf,0xd0,0xd1,0xd1,0xd1,0xd1,0xd2,0xd2,0xd3,0xd4,0xd4,0xd4,0xd3,0xd2,0xd0,0xcc,0xc8,0xc4,0xbf,0xba,0xb4,0xaf,0xa9,0xa2,0x9b,0x94,0x8d,0x86,0x80,0x7b,0x78,0x77,0x77,0x78,0x79,0x7b,0x7c,0x7d,0x7e,0x7e,0x7e,0x7e,0x23,0x25,0x29,0x2f,0x38,0x45,0x56,0x69,0x7d,0x91,0xa2,0xb0,0xb9,0xbf,0xc3,0xc4,0xc5,0xc5,0xc4,0xc4,0xc6,0xc7,0xc8,0xc9,0xca,0xca,0xcb,0xcc,0xcd,0xce,0xd0,0xd2,0xd4,0xd5,0xd5,0xd4,0xd2,0xcf,0xcb,0xc7,0xc1,0xbc,0xb6,0xb0,0xab,0xa4,0x9d,0x96,0x8f,0x88,0x83,0x7f,0x7c,0x7b,0x7b,0x7c,0x7e,0x7f,0x81,0x82,0x83,0x83,0x83,0x83,0x26,0x28,0x2c,0x32,0x3b,0x48,0x59,0x6c,0x80,0x93,0xa4,0xb2,0xba,0xbf,0xc2,0xc2,0xc1,0xbf,0xbe,0xbd,0xbe,0xbf,0xc0,0xc1,0xc3,0xc4,0xc5,0xc7,0xc8,0xca,0xcd,0xd0,0xd3,0xd5,0xd6,0xd6,0xd4,0xd1,0xcd,0xc8,0xc3,0xbd,0xb7,0xb1,0xac,0xa5,0x9f,0x98,0x91,0x8b,0x86,0x82,0x80,0x7f,0x80,0x81,0x83,0x85,0x87,0x89,0x89,0x8a,0x8a,0x8a,0x29,0x2b,0x2f,0x35,0x3d,0x4a,0x5b,0x6d,0x81,0x94,0xa5,0xb2,0xba,0xbe,0xbf,0xbf,0xbd,0xba,0xb8,0xb7,0xb8,0xb9,0xba,0xbb,0xbd,0xbe,0xc0,0xc2,0xc4,0xc7,0xca,0xce,0xd1,0xd4,0xd5,0xd6,0xd5,0xd2,0xce,0xc8,0xc3,0xbc,0xb6,0xb1,0xab,0xa6,0x9f,0x99,0x93,0x8d,0x89,0x85,0x84,0x83,0x84,0x86,0x89,0x8c,0x8e,0x90,0x91,0x91,0x92,0x92,0x2b,0x2d,0x30,0x36,0x3e,0x4b,0x5b,0x6d,0x80,0x93,0xa3,0xaf,0xb7,0xbb,0xbc,0xbb,0xb9,0xb6,0xb4,0xb3,0xb3,0xb4,0xb6,0xb7,0xb9,0xbb,0xbd,0xbf,0xc1,0xc4,0xc7,0xcb,0xcf,0xd2,0xd4,0xd4,0xd3,0xd0,0xcc,0xc6,0xc0,0xba,0xb4,0xae,0xa9,0xa4,0x9e,0x98,0x93,0x8e,0x8a,0x87,0x86,0x87,0x89,0x8b,0x8f,0x92,0x95,0x98,0x99,0x9a,0x9a,0x9b,0x2b,0x2d,0x31,0x36,0x3e,0x4a,0x5a,0x6b,0x7d,0x8f,0x9e,0xab,0xb2,0xb6,0xb8,0xb8,0xb6,0xb4,0xb2,0xb1,0xb2,0xb3,0xb5,0xb6,0xb8,0xba,0xbc,0xbe,0xc0,0xc2,0xc6,0xc9,0xcc,0xce,0xd0,0xd0,0xcf,0xcb,0xc7,0xc1,0xbb,0xb4,0xae,0xa8,0xa4,0x9f,0x9a,0x95,0x90,0x8c,0x89,0x87,0x87,0x89,0x8c,0x90,0x94,0x99,0x9d,0xa0,0xa2,0xa3,0xa4,0xa4,0x2b,0x2d,0x30,0x35,0x3c,0x48,0x56,0x66,0x77,0x88,0x96,0xa2,0xaa,0xaf,0xb2,0xb3,0xb3,0xb3,0xb2,0xb3,0xb4,0xb6,0xb8,0xb9,0xbb,0xbd,0xbe,0xc0,0xc1,0xc3,0xc5,0xc7,0xc9,0xca,0xcb,0xca,0xc8,0xc4,0xbe,0xb8,0xb1,0xab,0xa4,0x9f,0x9a,0x96,0x92,0x8e,0x8a,0x87,0x86,0x85,0x86,0x8a,0x8e,0x94,0x9b,0xa1,0xa7,0xab,0xae,0xb0,0xb1,0xb2,0x2a,0x2b,0x2e,0x33,0x3a,0x44,0x51,0x5f,0x6f,0x7e,0x8b,0x97,0x9f,0xa5,0xaa,0xad,0xb0,0xb2,0xb4,0xb6,0xb9,0xbb,0xbd,0xbf,0xc0,0xc2,0xc3,0xc4,0xc4,0xc5,0xc6,0xc6,0xc6,0xc6,0xc4,0xc2,0xbf,0xba,0xb4,0xad,0xa5,0x9e,0x98,0x92,0x8e,0x8a,0x87,0x84,0x82,0x81,0x81,0x82,0x85,0x8a,0x91,0x9a,0xa3,0xab,0xb3,0xb9,0xbd,0xbf,0xc1,0xc2,0x28,0x29,0x2c,0x31,0x36,0x3f,0x4a,0x57,0x64,0x72,0x7e,0x89,0x92,0x9a,0xa1,0xa7,0xad,0xb2,0xb6,0xba,0xbe,0xc1,0xc3,0xc5,0xc7,0xc8,0xc8,0xc8,0xc8,0xc7,0xc6,0xc5,0xc3,0xc0,0xbd,0xb9,0xb4,0xae,0xa7,0xa0,0x98,0x90,0x89,0x84,0x80,0x7d,0x7b,0x7a,0x79,0x79,0x7b,0x7e,0x83,0x8a,0x94,0x9f,0xab,0xb6,0xc0,0xc8,0xcd,0xd0,0xd2,0xd3,0x26,0x27,0x2a,0x2d,0x33,0x3a,0x43,0x4e,0x59,0x65,0x70,0x7b,0x84,0x8d,0x97,0xa0,0xa9,0xb1,0xb8,0xbe,0xc3,0xc7,0xca,0xcc,0xcd,0xce,0xcd,0xcd,0xcb,0xc9,0xc6,0xc2,0xbe,0xb9,0xb4,0xaf,0xa9,0xa2,0x9a,0x92,0x89,0x82,0x7b,0x76,0x73,0x71,0x6f,0x6f,0x70,0x72,0x76,0x7a,0x81,0x8b,0x97,0xa5,0xb3,0xc1,0xcd,0xd6,0xdc,0xe1,0xe4,0xe5,0x24,0x25,0x27,0x2a,0x2f,0x35,0x3c,0x45,0x4e,0x58,0x62,0x6c,0x76,0x81,0x8c,0x98,0xa4,0xaf,0xb8,0xc0,0xc6,0xcb,0xce,0xd0,0xd1,0xd2,0xd1,0xcf,0xcd,0xc9,0xc5,0xbf,0xb8,0xb2,0xab,0xa4,0x9d,0x96,0x8d,0x84,0x7c,0x74,0x6e,0x69,0x67,0x65,0x65,0x67,0x69,0x6d,0x72,0x78,0x81,0x8c,0x9b,0xab,0xbc,0xcb,0xd9,0xe4,0xeb,0xf0,0xf4,0xf5,0x22,0x22,0x24,0x27,0x2b,0x30,0x36,0x3c,0x44,0x4d,0x55,0x5f,0x69,0x75,0x82,0x90,0x9e,0xab,0xb7,0xc1,0xc8,0xcd,0xd0,0xd2,0xd3,0xd3,0xd1,0xcf,0xcc,0xc7,0xc1,0xb9,0xb1,0xa9,0xa1,0x99,0x92,0x8a,0x81,0x78,0x70,0x69,0x63,0x5f,0x5d,0x5d,0x5e,0x61,0x64,0x6a,0x70,0x78,0x82,0x8f,0x9f,0xb1,0xc3,0xd5,0xe4,0xf0,0xf8,0xfd,0xff,0xff,0x20,0x20,0x22,0x24,0x27,0x2b,0x30,0x35,0x3c,0x43,0x4b,0x54,0x5e,0x6a,0x78,0x88,0x97,0xa6,0xb3,0xbe,0xc5,0xca,0xce,0xd0,0xd0,0xcf,0xce,0xcb,0xc7,0xc2,0xba,0xb2,0xa9,0x9f,0x96,0x8e,0x87,0x7f,0x77,0x6f,0x67,0x61,0x5c,0x59,0x58,0x59,0x5b,0x5f,0x64,0x6a,0x72,0x7b,0x86,0x94,0xa5,0xb7,0xca,0xdc,0xec,0xf8,0xff,0xff,0xff,0xff,0x1e,0x1e,0x20,0x22,0x25,0x28,0x2c,0x30,0x35,0x3c,0x43,0x4b,0x55,0x61,0x70,0x7f,0x8f,0x9e,0xac,0xb6,0xbe,0xc3,0xc6,0xc7,0xc8,0xc6,0xc4,0xc1,0xbd,0xb7,0xb0,0xa7,0x9e,0x94,0x8b,0x83,0x7c,0x76,0x6f,0x68,0x63,0x5e,0x5b,0x59,0x59,0x5b,0x5f,0x63,0x69,0x70,0x79,0x82,0x8d,0x9b,0xac,0xbe,0xd0,0xe1,0xf0,0xfc,0xff,0xff,0xff,0xff,0x1c,0x1d,0x1e,0x20,0x22,0x25,0x28,0x2c,0x31,0x36,0x3c,0x44,0x4d,0x59,0x67,0x76,0x85,0x94,0xa1,0xab,0xb1,0xb6,0xb8,0xb9,0xb9,0xb7,0xb5,0xb2,0xae,0xa8,0xa0,0x98,0x8f,0x86,0x7e,0x77,0x72,0x6d,0x69,0x65,0x62,0x60,0x5f,0x5f,0x61,0x65,0x69,0x6f,0x76,0x7e,0x86,0x90,0x9a,0xa7,0xb7,0xc7,0xd7,0xe7,0xf4,0xff,0xff,0xff,0xff,0xff,0x1a,0x1b,0x1c,0x1e,0x20,0x22,0x25,0x29,0x2d,0x32,0x37,0x3e,0x47,0x51,0x5e,0x6c,0x7a,0x87,0x92,0x9b,0xa1,0xa5,0xa6,0xa7,0xa5,0xa3,0xa0,0x9d,0x9a,0x94,0x8d,0x85,0x7d,0x76,0x6f,0x6a,0x67,0x65,0x64,0x63,0x64,0x65,0x68,0x6b,0x6f,0x74,0x7a,0x81,0x88,0x91,0x99,0xa3,0xac,0xb8,0xc5,0xd2,0xdf,0xec,0xf7,0xff,0xff,0xff,0xff,0xff,0x19,0x19,0x1a,0x1c,0x1e,0x20,0x23,0x26,0x2a,0x2e,0x33,0x3a,0x41,0x4a,0x55,0x61,0x6d,0x79,0x82,0x8a,0x8f,0x91,0x92,0x91,0x8f,0x8c,0x89,0x86,0x83,0x7e,0x78,0x71,0x6a,0x64,0x60,0x5d,0x5c,0x5d,0x60,0x63,0x68,0x6d,0x73,0x79,0x7f,0x86,0x8d,0x96,0x9e,0xa7,0xaf,0xb8,0xc0,0xca,0xd4,0xde,0xe7,0xf0,0xf8,0xff,0xff,0xff,0xff,0xff,0x17,0x17,0x18,0x1a,0x1c,0x1e,0x20,0x24,0x27,0x2b,0x30,0x35,0x3b,0x43,0x4d,0x56,0x60,0x6a,0x71,0x77,0x7b,0x7c,0x7b,0x7a,0x77,0x74,0x71,0x6d,0x6b,0x66,0x61,0x5c,0x57,0x53,0x50,0x50,0x51,0x56,0x5c,0x64,0x6d,0x76,0x7f,0x88,0x90,0x99,0xa2,0xab,0xb4,0xbd,0xc5,0xcd,0xd4,0xdb,0xe2,0xe8,0xee,0xf3,0xf8,0xfb,0xfe,0xff,0xff,0xff,0x15,0x16,0x16,0x18,0x19,0x1c,0x1e,0x21,0x25,0x29,0x2d,0x32,0x37,0x3d,0x44,0x4c,0x54,0x5b,0x60,0x65,0x67,0x67,0x65,0x63,0x60,0x5c,0x58,0x55,0x53,0x50,0x4c,0x48,0x44,0x42,0x41,0x43,0x47,0x4f,0x59,0x64,0x71,0x7e,0x8a,0x96,0xa0,0xaa,0xb4,0xbe,0xc7,0xd0,0xd8,0xdf,0xe5,0xe9,0xed,0xef,0xf2,0xf3,0xf4,0xf6,0xf7,0xf8,0xf8,0xf9,0x13,0x14,0x15,0x16,0x17,0x19,0x1c,0x1f,0x22,0x26,0x2a,0x2e,0x32,0x37,0x3c,0x42,0x47,0x4d,0x51,0x53,0x54,0x53,0x51,0x4e,0x4a,0x46,0x43,0x40,0x3e,0x3b,0x38,0x36,0x34,0x33,0x34,0x37,0x3e,0x48,0x55,0x64,0x73,0x83,0x92,0xa0,0xac,0xb7,0xc2,0xcc,0xd6,0xdf,0xe6,0xec,0xf0,0xf3,0xf3,0xf3,0xf1,0xf0,0xee,0xed,0xed,0xec,0xec,0xec,0x12,0x12,0x13,0x14,0x15,0x17,0x1a,0x1d,0x20,0x23,0x26,0x2a,0x2d,0x30,0x35,0x39,0x3d,0x40,0x43,0x44,0x44,0x43,0x40,0x3c,0x38,0x34,0x31,0x2e,0x2d,0x2b,0x28,0x27,0x26,0x26,0x29,0x2d,0x35,0x41,0x50,0x61,0x73,0x85,0x96,0xa5,0xb2,0xbd,0xc9,0xd3,0xdd,0xe5,0xec,0xf1,0xf5,0xf5,0xf3,0xf0,0xec,0xe8,0xe4,0xe1,0xdf,0xde,0xde,0xde,0x10,0x10,0x11,0x12,0x13,0x15,0x17,0x1a,0x1c,0x1f,0x22,0x25,0x27,0x2a,0x2d,0x31,0x33,0x36,0x38,0x38,0x38,0x36,0x33,0x2f,0x2b,0x27,0x24,0x22,0x20,0x1f,0x1d,0x1c,0x1c,0x1d,0x20,0x26,0x2e,0x3b,0x4b,0x5c,0x6f,0x82,0x93,0xa3,0xaf,0xbb,0xc6,0xd1,0xda,0xe2,0xe8,0xed,0xef,0xee,0xeb,0xe6,0xe0,0xda,0xd5,0xd1,0xce,0xcd,0xcc,0xcc,0x0e,0x0e,0x0f,0x0f,0x10,0x12,0x14,0x16,0x19,0x1b,0x1e,0x20,0x22,0x24,0x26,0x29,0x2b,0x2c,0x2e,0x2e,0x2d,0x2b,0x29,0x25,0x21,0x1e,0x1b,0x19,0x18,0x17,0x15,0x15,0x15,0x16,0x1a,0x1f,0x28,0x34,0x44,0x55,0x67,0x79,0x8a,0x99,0xa5,0xb0,0xbb,0xc4,0xcd,0xd4,0xd9,0xdd,0xde,0xdc,0xd8,0xd2,0xcb,0xc4,0xbe,0xb9,0xb7,0xb5,0xb4,0xb3,0x0c,0x0c,0x0c,0x0d,0x0e,0x0f,0x11,0x13,0x15,0x17,0x19,0x1b,0x1c,0x1e,0x20,0x21,0x23,0x24,0x24,0x25,0x24,0x22,0x20,0x1d,0x19,0x16,0x14,0x12,0x12,0x11,0x10,0x10,0x10,0x12,0x15,0x1a,0x22,0x2e,0x3c,0x4c,0x5d,0x6e,0x7d,0x8b,0x96,0x9f,0xa9,0xb1,0xb8,0xbe,0xc2,0xc5,0xc5,0xc3,0xbe,0xb7,0xb0,0xa8,0xa1,0x9c,0x99,0x97,0x96,0x95,0x09,0x0a,0x0a,0x0b,0x0b,0x0c,0x0e,0x0f,0x11,0x13,0x14,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1c,0x1c,0x1c,0x1a,0x18,0x16,0x13,0x11,0x0f,0x0e,0x0e,0x0d,0x0d,0x0c,0x0d,0x0e,0x11,0x16,0x1d,0x27,0x34,0x42,0x51,0x60,0x6d,0x79,0x82,0x8a,0x92,0x99,0x9e,0xa3,0xa6,0xa7,0xa7,0xa4,0x9e,0x97,0x90,0x88,0x81,0x7c,0x79,0x77,0x76,0x75,0x07,0x08,0x08,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0f,0x10,0x11,0x12,0x12,0x13,0x14,0x14,0x15,0x15,0x15,0x14,0x13,0x12,0x10,0x0f,0x0d,0x0c,0x0c,0x0b,0x0b,0x0b,0x0b,0x0b,0x0c,0x0f,0x13,0x19,0x22,0x2c,0x38,0x45,0x51,0x5c,0x65,0x6d,0x73,0x79,0x7e,0x82,0x85,0x87,0x88,0x87,0x83,0x7d,0x76,0x6e,0x67,0x60,0x5b,0x58,0x56,0x54,0x54,0x05,0x06,0x06,0x06,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0c,0x0d,0x0d,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0d,0x0c,0x0b,0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,0x0b,0x0d,0x10,0x15,0x1c,0x25,0x2e,0x38,0x42,0x4b,0x52,0x58,0x5d,0x61,0x64,0x67,0x69,0x69,0x69,0x67,0x63,0x5d,0x56,0x4e,0x47,0x40,0x3b,0x38,0x36,0x35,0x34,0x04,0x04,0x04,0x04,0x04,0x05,0x06,0x06,0x07,0x08,0x08,0x09,0x09,0x09,0x09,0x09,0x09,0x09,0x09,0x09,0x09,0x09,0x08,0x08,0x08,0x08,0x08,0x08,0x09,0x09,0x09,0x09,0x09,0x0a,0x0c,0x0e,0x12,0x18,0x1e,0x26,0x2e,0x35,0x3c,0x41,0x45,0x49,0x4b,0x4d,0x4e,0x4f,0x4e,0x4d,0x4b,0x46,0x40,0x39,0x32,0x2b,0x24,0x1f,0x1c,0x1a,0x19,0x18,0x02,0x02,0x03,0x03,0x03,0x03,0x04,0x04,0x04,0x05,0x05,0x05,0x06,0x05,0x05,0x05,0x05,0x04,0x04,0x04,0x04,0x04,0x05,0x05,0x05,0x06,0x06,0x07,0x08,0x08,0x08,0x08,0x09,0x09,0x0b,0x0d,0x10,0x14,0x19,0x1f,0x25,0x2b,0x30,0x34,0x37,0x39,0x3b,0x3b,0x3c,0x3b,0x3a,0x38,0x35,0x30,0x2a,0x23,0x1c,0x15,0x0e,0x0a,0x07,0x04,0x03,0x02,0x01,0x01,0x02,0x02,0x02,0x02,0x02,0x02,0x03,0x03,0x03,0x03,0x03,0x03,0x02,0x02,0x01,0x01,0x00,0x00,0x00,0x01,0x01,0x02,0x03,0x04,0x04,0x05,0x06,0x06,0x06,0x07,0x07,0x08,0x09,0x0b,0x0d,0x11,0x16,0x1b,0x20,0x25,0x29,0x2d,0x2f,0x30,0x31,0x31,0x30,0x2f,0x2d,0x2b,0x28,0x22,0x1c,0x15,0x0e,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x02,0x02,0x02,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x02,0x03,0x04,0x04,0x05,0x05,0x06,0x06,0x07,0x08,0x09,0x0c,0x0f,0x13,0x18,0x1c,0x21,0x24,0x27,0x29,0x29,0x2a,0x29,0x29,0x27,0x25,0x22,0x1e,0x19,0x12,0x0b,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x03,0x03,0x04,0x04,0x05,0x05,0x06,0x07,0x08,0x0b,0x0e,0x11,0x16,0x1a,0x1e,0x21,0x23,0x25,0x25,0x25,0x24,0x23,0x21,0x1f,0x1c,0x18,0x13,0x0c,0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x02,0x03,0x03,0x04,0x04,0x05,0x06,0x07,0x08,0x0a,0x0d,0x11,0x15,0x19,0x1c,0x1f,0x22,0x23,0x23,0x23,0x22,0x21,0x1f,0x1c,0x19,0x15,0x0f,0x09,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

    
    
    
static float cubic_hermite(float A, float B, float C, float D, float t) {
 
    float a = -A / 2.0f + (3.0f*B) / 2.0f - (3.0f*C) / 2.0f + D / 2.0f;
    float b = A - (5.0f*B) / 2.0f + 2.0f*C - D / 2.0f;
    float c = -A / 2.0f + C / 2.0f;
    float d = B;
 
    return a*t*t*t + b*t*t + c*t + d;
}
 
void get_pixel_clamped(int16_t *source_data, int x, int y, int16_t *temp)  {
 
    CLAMP(x, 0, SOURCE_X - 1);
    CLAMP(y, 0, SOURCE_Y - 1);
    //Debug("get source_image pixel x=%d y=%d",x,y);
    
    *temp = source_data[x+(SOURCE_X*y)];
    
}
 
void sample_bicubic(int16_t *source_data, float u, float v, int16_t sample[]) {
 
    float x = (u * SOURCE_X) - 0.5f;
    int xint = (int)x;
    float xfract = x-floor(x);
 
    float y = (v * SOURCE_Y) - 0.5f;
    int yint = (int)y;
    float yfract = y - floor(y);
    
    int i;
 
    int16_t p00[1];
    int16_t p10[1];
    int16_t p20[1];
    int16_t p30[1];
    
    int16_t p01[1];
    int16_t p11[1];
    int16_t p21[1];
    int16_t p31[1];
 
    int16_t p02[1];
    int16_t p12[1];
    int16_t p22[1];
    int16_t p32[1];
 
    int16_t p03[1];
    int16_t p13[1];
    int16_t p23[1];
    int16_t p33[1];
    
    // 1st row
    get_pixel_clamped(source_data, xint - 1, yint - 1, p00);   
    get_pixel_clamped(source_data, xint + 0, yint - 1, p10);
    get_pixel_clamped(source_data, xint + 1, yint - 1, p20);
    get_pixel_clamped(source_data, xint + 2, yint - 1, p30);
    
    // 2nd row
    get_pixel_clamped(source_data, xint - 1, yint + 0, p01);
    get_pixel_clamped(source_data, xint + 0, yint + 0, p11);
    get_pixel_clamped(source_data, xint + 1, yint + 0, p21);
    get_pixel_clamped(source_data, xint + 2, yint + 0, p31);
 
    // 3rd row
    get_pixel_clamped(source_data, xint - 1, yint + 1, p02);
    get_pixel_clamped(source_data, xint + 0, yint + 1, p12);
    get_pixel_clamped(source_data, xint + 1, yint + 1, p22);
    get_pixel_clamped(source_data, xint + 2, yint + 1, p32);
 
    // 4th row
    get_pixel_clamped(source_data, xint - 1, yint + 2, p03);
    get_pixel_clamped(source_data, xint + 0, yint + 2, p13);
    get_pixel_clamped(source_data, xint + 1, yint + 2, p23);
    get_pixel_clamped(source_data, xint + 2, yint + 2, p33);
    
    // interpolate bi-cubically!
    for (i = 0; i < 1; i++) {
 
        float col0 = cubic_hermite(p00[i], p10[i], p20[i], p30[i], xfract);
        float col1 = cubic_hermite(p01[i], p11[i], p21[i], p31[i], xfract);
        float col2 = cubic_hermite(p02[i], p12[i], p22[i], p32[i], xfract);
        float col3 = cubic_hermite(p03[i], p13[i], p23[i], p33[i], xfract);
 
        float value = cubic_hermite(col0, col1, col2, col3, yfract);
 
        //CLAMP(value, 0.0f, 255.0f);
 
        sample[i] = (int16_t)value;
        
        //Debug("sample[%d]=%d\n",i,sample[i]);      
        
    }
    
}
 
void resize_image(int16_t *source_data) {
 
    int16_t sample[1];
    int y, x;
    
    for (y = 0; y < DEST_Y; y++) {
 
        float v = (float)y / (float)(DEST_Y - 1);
        for (x = 0; x < DEST_X; x++) {
 
            float u = (float)x / (float)(DEST_X - 1);
            
            sample_bicubic(source_data, u, v, sample);
            
            destination_data[x+(DEST_X*y)] = sample[0];
            //Debug("set destination_image pixel x=%d y=%d, memory%d",x,y, x+((SOURCE_X * SCALE)*y));
            
        }
    }
}

int16_t max(int16_t* a, int n)
{
    int16_t maxnum = a[0];
    
    for(int i=0;i<n;i++)
    {
        if(a[i] > maxnum)
            maxnum = a[i];
    
    }
    return maxnum;
}

int16_t min(int16_t* a, int n)
{
    int16_t minnum = a[0];
    
    for(int i=0;i<n;i++)
    {
        if(a[i] < minnum)
            minnum = a[i];
    
    }
    return minnum;
}

int16_t get_dest(int x, int y){

    return destination_data[x+(DEST_X*y)];

}

void set_dest(int x, int y, int16_t val){

    destination_data[x+(DEST_X*y)] = val;

}

void set_xbm(uint8_t* xbm, int x, int y){

    xbm[(x+(DEST_X*y))/8] |= ( 1 << ( ( x + (DEST_X * y) ) % 8 ) );

}


void showFloyd(int16_t *source_data, uint8_t* xbm)
{
    
    int x,y;

    resize_image(source_data);
    
    
    int16_t maxnum = max(destination_data, DEST_X * DEST_Y);
    int16_t minnum = min(destination_data, DEST_X * DEST_Y);
    int16_t avgnum = (maxnum + minnum) / 2;
    
    Debug("Max %d, Min %d, avg %d",maxnum,minnum,avgnum);
    
    for (y = 0; y < DEST_Y; y++) {
 
        for (x = 0; x < DEST_X; x++) {
 
            int16_t pixel = get_dest(x, y);
            int16_t err;
            
            if(pixel < avgnum)
            {
                err = pixel - minnum;
            }
            
            else
            {
                set_xbm(xbm, x, y);
                err = pixel - maxnum;
            }
            
            if(y+1<=(DEST_Y-1)){
                set_dest(x, y+1, get_dest(x, y+1) + (err * 7 / 16));
            }
                
            
            if(x+1<=(DEST_X-1) && y>=1){
                set_dest(x+1, y-1, get_dest(x+1, y-1) + (err * 3 / 16));
            }
                
            
            if(x+1<=(DEST_X-1)){
                set_dest(x+1, y, get_dest(x+1, y) + (err * 5 / 16));
            }
                
            
            if(x+1<=(DEST_X-1) && y+1<=(DEST_Y-1))
            {
                set_dest(x+1, y+1, get_dest(x+1, y+1) + (err * 1 / 16));
            }
                
            
        }
    }
    
}


